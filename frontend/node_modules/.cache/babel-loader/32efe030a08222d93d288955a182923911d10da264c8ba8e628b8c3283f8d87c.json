{"ast":null,"code":"// src/routes/productRoutes.js\n\nconst express = require('express');\nconst Product = require('../models/Product');\nconst jwt = require('jsonwebtoken');\nconst router = express.Router();\n\n// Middleware para verificar el token y rol\nconst verifyAdmin = (req, res, next) => {\n  var _req$headers$authoriz;\n  const token = (_req$headers$authoriz = req.headers['authorization']) === null || _req$headers$authoriz === void 0 ? void 0 : _req$headers$authoriz.split(' ')[1];\n  if (!token) return res.status(401).json({\n    message: 'Acceso denegado. No se encontró el token.'\n  });\n  try {\n    const decodedToken = jwt.verify(token, process.env.JWT_SECRET);\n    if (decodedToken.user.role !== 'admin') {\n      return res.status(403).json({\n        message: 'No tienes permisos para realizar esta acción.'\n      });\n    }\n    req.user = decodedToken.user; // Establecer usuario en la solicitud para uso posterior\n    next();\n  } catch (error) {\n    return res.status(401).json({\n      message: 'Token no válido.',\n      error: error.message\n    });\n  }\n};\n\n// Ruta para agregar un producto\nrouter.post('/', verifyAdmin, async (req, res) => {\n  const {\n    name,\n    description,\n    price,\n    category,\n    quantity\n  } = req.body;\n\n  // Validación de campos obligatorios\n  if (!name || !description || !price || !category || quantity === undefined) {\n    return res.status(400).json({\n      message: 'Todos los campos son obligatorios: nombre, descripción, precio, categoría y cantidad.'\n    });\n  }\n\n  // Validación de tipo de datos\n  if (typeof price !== 'number' || price <= 0) {\n    return res.status(400).json({\n      message: 'El precio debe ser un número positivo.'\n    });\n  }\n  if (typeof quantity !== 'number' || quantity < 0) {\n    return res.status(400).json({\n      message: 'La cantidad debe ser un número mayor o igual a 0.'\n    });\n  }\n  try {\n    const newProduct = new Product({\n      name,\n      description,\n      price,\n      category,\n      quantity\n    });\n    await newProduct.save();\n    res.status(201).json({\n      message: 'Producto añadido exitosamente',\n      product: newProduct\n    });\n  } catch (error) {\n    res.status(500).json({\n      message: 'Error al agregar el producto',\n      error: error.message\n    });\n  }\n});\nmodule.exports = router;","map":{"version":3,"names":["express","require","Product","jwt","router","Router","verifyAdmin","req","res","next","_req$headers$authoriz","token","headers","split","status","json","message","decodedToken","verify","process","env","JWT_SECRET","user","role","error","post","name","description","price","category","quantity","body","undefined","newProduct","save","product","module","exports"],"sources":["C:/Users/juanm/OneDrive/Escritorio/R/frontend/src/componentes/ManageAdmin.js"],"sourcesContent":["// src/routes/productRoutes.js\r\n\r\nconst express = require('express');\r\nconst Product = require('../models/Product');\r\nconst jwt = require('jsonwebtoken');\r\nconst router = express.Router();\r\n\r\n// Middleware para verificar el token y rol\r\nconst verifyAdmin = (req, res, next) => {\r\n  const token = req.headers['authorization']?.split(' ')[1];\r\n  if (!token) return res.status(401).json({ message: 'Acceso denegado. No se encontró el token.' });\r\n\r\n  try {\r\n    const decodedToken = jwt.verify(token, process.env.JWT_SECRET);\r\n    if (decodedToken.user.role !== 'admin') {\r\n      return res.status(403).json({ message: 'No tienes permisos para realizar esta acción.' });\r\n    }\r\n    req.user = decodedToken.user;  // Establecer usuario en la solicitud para uso posterior\r\n    next();\r\n  } catch (error) {\r\n    return res.status(401).json({ message: 'Token no válido.', error: error.message });\r\n  }\r\n};\r\n\r\n// Ruta para agregar un producto\r\nrouter.post('/', verifyAdmin, async (req, res) => {\r\n  const { name, description, price, category, quantity } = req.body;\r\n\r\n  // Validación de campos obligatorios\r\n  if (!name || !description || !price || !category || quantity === undefined) {\r\n    return res.status(400).json({ message: 'Todos los campos son obligatorios: nombre, descripción, precio, categoría y cantidad.' });\r\n  }\r\n\r\n  // Validación de tipo de datos\r\n  if (typeof price !== 'number' || price <= 0) {\r\n    return res.status(400).json({ message: 'El precio debe ser un número positivo.' });\r\n  }\r\n\r\n  if (typeof quantity !== 'number' || quantity < 0) {\r\n    return res.status(400).json({ message: 'La cantidad debe ser un número mayor o igual a 0.' });\r\n  }\r\n\r\n  try {\r\n    const newProduct = new Product({\r\n      name,\r\n      description,\r\n      price,\r\n      category,\r\n      quantity,\r\n    });\r\n\r\n    await newProduct.save();\r\n    res.status(201).json({ message: 'Producto añadido exitosamente', product: newProduct });\r\n  } catch (error) {\r\n    res.status(500).json({ message: 'Error al agregar el producto', error: error.message });\r\n  }\r\n});\r\n\r\nmodule.exports = router;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}